<html>
    <head>
        <script src="../../build/bundle.js"></script>
        <style>
          #tabs {border-bottom:1px solid #ccc;height:33px;margin:0 0 10px;padding-top:5px;background:#eee;}
          #tabs a {float:left;margin-left:2px;border-radius:3px 3px 0 0;border:1px solid #eee;border-bottom-color:#ccc;color:#08c;height:32px;line-height:32px;padding:0 12px;text-decoration:none;}
          #tabs a:hover {background:#ddd;color:#058;border-color:#ddd #ddd #ccc;}
          #tabs a.active {background:#fff;color:#555;border-color:#ccc #ccc #fff;}
          #tabs a.active:hover {background:#fff;color:#555;border-color:#ccc #ccc #fff;}
          #tabs_data fieldset {display:none;border:0;}
          #tabs_data fieldset div {font-size:13px;}
        </style>
    </head>
    <body>
      <div id="tabs">
        <a href="#" onclick="tab_click(0);">From DER</a>
        <a href="#" onclick="tab_click(1);">Signing</a>
      </div>
      <div id="tabs_data">
        <fieldset>
          Signed data in DER format : <input type="file" id="der"></input>
        </fieldset>
        <fieldset>
          File to be signed : <input type="file" id="file-to-sign"></input>
          <br>Certificate in PEM : <input type="file" id="to-sign-certificate"></input>
          <br>Private Key in PEM : <input type="file" id="to-sign-private-key"></input>
          <br><br><button id="to-sign-trigger">Tanda tangani</button>
        </fieldset>
      </div>
            
      <script>
      var derData;
      var fileToBeSigned;
      var certificateToSign;
      var privateKeyToSign;
      
      document.getElementById('der').addEventListener('change', function(evt){
        files = evt.target.files; // FileList object  
        // files is a FileList of File objects. List some properties.
        // Read file as ArrayBuffer
        var reader = new window.FileReader()
        reader.readAsBinaryString(files[files.length-1]);
        /* reader.readAsBinaryString(files[0]); */
        reader.onload = function(e) {
          derData = reader.result;
          var signedData = window.PKIWebSDK.SignedData.parseDER(derData);
          var data = signedData.getData();
          console.log(data);
          data.certificates[0].getSubject()
            .then(function(subject){
              alert("Certificate's subject \n" + JSON.stringify(subject));
            })
         }
      });
      document.getElementById('file-to-sign').addEventListener('change', function(evt){
        files = evt.target.files; // FileList object  
        // files is a FileList of File objects. List some properties.
        // Read file as ArrayBuffer
        var reader = new window.FileReader()
        reader.readAsBinaryString(files[files.length-1]);
        reader.onload = function(e) {
          fileToBeSigned = reader.result;
         }
      });
      document.getElementById('to-sign-certificate').addEventListener('change', function(evt){
        var files = evt.target.files; // FileList object  
        // files is a FileList of File objects. List some properties.
        // Read file as ArrayBuffer
        var reader = new window.FileReader()
        reader.readAsText(files[files.length-1]);
        reader.onload = function(e) {
          var cert = new window.PKIWebSDK.Certificate();
          cert.parsePEM(reader.result)
            .then(function(cert){
              certificateToSign = cert;
            })
         }
      });
      document.getElementById('to-sign-private-key').addEventListener('change', function(evt){
        var files = evt.target.files; // FileList object  
        // files is a FileList of File objects. List some properties.
        // Read file as ArrayBuffer
        var reader = new window.FileReader()
        reader.readAsText(files[files.length-1]);
        reader.onload = function(e) {
          window.PKIWebSDK.Key.parsePEM(reader.result, "SHA-256")
            .then(function(key){
              privateKeyToSign = key;
            })
         }
      });

      document.getElementById("to-sign-trigger").addEventListener("click", function(evt){
        window.PKIWebSDK.SignedData.sign(certificateToSign, privateKeyToSign, fileToBeSigned)
          .then(function(result){
            console.log(result);
          })
      })

      var tabActive=1, tabs=document.getElementById('tabs').getElementsByTagName('a'), tabs_data=document.getElementById('tabs_data').getElementsByTagName('fieldset');
      function tab_click(x){
        if(x > -1 && x < tabs.length && x < tabs_data.length){
          tabs[tabActive].setAttribute('class','');
              tabs_data[tabActive].style.display='none';
          tabActive=x;
          tabs[tabActive].setAttribute('class','active');
              tabs_data[tabActive].style.display='block';
        } return false;
      }
      tab_click(0);
      </script>
    </body>
</html>




